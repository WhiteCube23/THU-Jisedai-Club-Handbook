\documentclass[twoside]{book}
\usepackage[fontset=none]{ctex}
\setCJKmainfont{SimSun}[
  BoldFont = SimHei,
  ItalicFont = KaiTi,
  BoldItalicFont = KaiTi
]
\usepackage{tcolorbox}
\tcbuselibrary{skins, breakable}
\usepackage{tikz}
\usepackage{graphicx}
\graphicspath{{figures/}}
\usepackage{xcolor}
\usepackage{eso-pic}
\usepackage{geometry}
%\usepackage{showframe}
\usepackage{fancyhdr}
\usepackage{comment}
\usepackage{eso-pic}
\geometry{a4paper, left=1.5cm, right=1.5cm, top=2cm, bottom=3cm}

\definecolor{truepurple}{RGB}{128, 0, 128}

\usetikzlibrary{fadings}
\geometry{
  top=1.5cm,       % 从3cm减小到1.5cm
  headheight=17.82637pt, % 解决fancyhdr警告
  headsep=10pt,     % 增加页眉与正文间距
  footskip=30pt     % 增加页脚与正文间距
}

% 定义聊天气泡样式
\newcounter{chatcounter}
\newcommand{\chatbubble}[4][left]{%
  \stepcounter{chatcounter}%
  \par\noindent%
  \ifstrequal{#1}{left}
    {% 左侧气泡
     \begin{minipage}[t]{1.2cm} % 头像宽度
        \begin{tikzpicture}[baseline=(current bounding box.center)]
          \node[circle, draw=gray!50, line width=0.5pt, minimum size=1.2cm, 
                path picture={\node at (path picture bounding box.center) 
                {\includegraphics[width=1.2cm]{#2}};}] {};
        \end{tikzpicture}
     \end{minipage}%
     \hspace{0.2cm}%
     \begin{minipage}[t]{0.7\textwidth} % 消息框宽度
        \vspace{-15pt} % 确保顶部对齐
        \noindent\textcolor{darkgray!80}{\sffamily #3} % 昵称
        \vspace{5pt}
        \begin{tcolorbox}[
          enhanced,
          breakable,
          colback=gray!5!white,
          colframe=gray!5!white,
          arc=8pt,
          boxrule=0.5pt,
          left=8pt,
          right=8pt,
          top=4pt,
          bottom=4pt,
          before skip=0pt,
          after skip=10pt,
          width=\linewidth
        ]
          #4
        \end{tcolorbox}
     \end{minipage}
    }
    {% 右侧气泡
     \hfill%
     \begin{minipage}[t]{0.7\textwidth} % 消息框宽度
        \vspace{-15pt} % 确保顶部对齐
        \noindent\hfill\textcolor{darkgray!80}{\sffamily #3} % 右对齐昵称
        \vspace{5pt}
        \hfill%
        \begin{tcolorbox}[
          enhanced,
          breakable,
          colback=truepurple!5!white,
          colframe=purple!3!white,
          arc=8pt,
          boxrule=0.5pt,
          left=8pt,
          right=8pt,
          top=4pt,
          bottom=4pt,
          before skip=0pt,
          after skip=10pt,
          width=\linewidth
        ]
          #4
        \end{tcolorbox}
     \end{minipage}%
     \hspace{0.2cm}%
     \begin{minipage}[t]{1.2cm} % 头像宽度
        \begin{tikzpicture}[baseline=(current bounding box.center)]
          \node[circle, draw=gray!50, line width=0.5pt, minimum size=1.2cm, 
                path picture={\node at (path picture bounding box.center) 
                {\includegraphics[width=1.2cm]{#2}};}] {};
        \end{tikzpicture}
     \end{minipage}
    }%
  \par\vspace{0.3cm}% 气泡间距
}

% 添加聊天背景

\pagestyle{fancy}
\fancyhf{} % 清空所有页眉页脚
\fancyhead[LE]{\hspace*{-1.5cm}\includegraphics[width=\paperwidth]{head.pdf}} % 偶数页左侧
\fancyhead[RO]{\hspace*{-1.5cm}\includegraphics[width=\paperwidth]{headr.pdf}} % 奇数页右侧
\renewcommand{\headrulewidth}{0pt}
\setlength{\headsep}{5mm}
\fancyfoot[LE]{\hspace{-1cm}\raisebox{-27pt}{\textcolor{white}{\textbf{\textsf{\thepage}}}}} % 偶数页左侧
\fancyfoot[RO]{\rlap{\hspace{0.8cm}\raisebox{-27pt}{\textcolor{white}{\textbf{\textsf{\thepage}}}}}}
\renewcommand{\footrulewidth}{0pt}
\AddToShipoutPictureBG{%
  \ifodd\value{page}
    \AtPageLowerLeft{%
      \raisebox{15pt}[0pt][0pt]{\includegraphics[width=\paperwidth]{footr.pdf}}%
    }
  \else
    \AtPageLowerLeft{%
      \raisebox{15pt}[0pt][0pt]{\includegraphics[width=\paperwidth]{footl.pdf}}%
    }
  \fi
}
\begin{document}
% 设置页眉页脚


% 添加渐变装饰线



\chatbubble[left]{qingfen.png}{22-清芬}{
紫哥桃子姐带我入社已经三年啦!次世代的社友个个都是人才，说话也好听，
玩得很开心呢，要说印象最深刻的当然是第一次idolive宅舞专场
我的舞台初体验啦，但是当然不仅限于此，每一天都很开心呢!
最喜欢次世代的大家了!
}


\chatbubble[left]{guitarhero.png}{吉他英雄}{
  加入动漫社……是不是意味着要参加好多好多线下活动?要自我介绍?要上舞台?
  这个绝对做做做做做做做做不到!
}

% 右侧聊天（用户B）
\chatbubble[right]{taozi.png}{12-桃子}{
 绝对没这回事!我们所有的活动都是自愿参加的!当然，我们欢
 迎每一位社员的热情。但是就算只是来咖啡厅买一杯特调，来社庆做
 一枚静静的观众，或在群聊里默
 默收集好看的图片也都没问题!我们的宗旨就是玩得开心!
}
\newpage
哇袄
\end{document}